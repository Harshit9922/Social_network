<?php
session_start();
require_once __DIR__ . '/classes/User.php';
$db=new Database(); $conn=$db->getConnection(); $userModel=new User($conn);
$errors=[]; if($_SERVER['REQUEST_METHOD']=='POST'){ $fullname=trim($_POST['fullname']); $dob=$_POST['dob']; $email=trim($_POST['email']); $password=$_POST['password']; $profile_pic='uploads/default.png'; if(!empty($_FILES['profile_pic']['name'])){ $allowed=['image/jpeg','image/png','image/webp']; if($_FILES['profile_pic']['error']===0 && in_array($_FILES['profile_pic']['type'],$allowed)){ $safe=time().'_'.preg_replace('/[^A-Za-z0-9._-]/','_',basename($_FILES['profile_pic']['name'])); $target='uploads/'.$safe; if(move_uploaded_file($_FILES['profile_pic']['tmp_name'],$target)) $profile_pic=$target; } else $errors[]='Invalid image type'; } if(!$fullname) $errors[]='Full name required'; if(!$dob) $errors[]='DOB required'; if(!filter_var($email,FILTER_VALIDATE_EMAIL)) $errors[]='Invalid email'; if(strlen($password)<6) $errors[]='Password must be 6+'; if(empty($errors)){ $res=$userModel->register($fullname,$dob,$email,$password,$profile_pic); if($res['success']){ $_SESSION['email']=$email; header('Location: user.php'); exit(); } else $errors[]=$res['error']; } } ?><!doctype html><html><head><meta charset='utf-8'><title>Signup</title><link rel='stylesheet' href='assets/style.css'></head><body><div class='form-container'><h2>Signup</h2><?php foreach($errors as $e) echo "<p class='error'>".htmlspecialchars($e)."</p>"; ?><form method='post' enctype='multipart/form-data'><input name='fullname' placeholder='Full Name' required><input name='dob' type='date' required><input name='email' type='email' placeholder='Email' required><input name='password' type='password' placeholder='Password' required><input name='profile_pic' type='file' accept='image/*'><button type='submit'>Signup</button></form><p>Already have an account? <a href='login.php'>Login</a></p></div></body></html>